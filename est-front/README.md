# Документация к Фронтенду проекта "E-Sketch".

## Оглавление
1. [Общее описание](#общее-описание)
2. [Структура проекта](#структура-проекта)
3. [Технологический стек](#технологический-стек)
4. [Установка и запуск](#установка-и-запуск)
5. [Маршрутизация](#маршрутизация)
6. [Основные компоненты](#основные-компоненты)
7. [Система состояний (Redux)](#система-состояний-redux)
8. [Работа с API](#работа-с-api)
9. [Функционал доски](#функционал-доски)
10. [Интеграция с WebSocket](#интеграция-с-websocket)
11. [Особенности реализации](#особенности-реализации)
12. [Развертывание](#развертывание)

## Общее описание

E-Sketch - это веб-приложение для совместной работы на интерактивной доске в реальном времени. Основные возможности:
- Рисование различных фигур (линии, прямоугольники, эллипсы)
- Удаление элементов
- Масштабирование и перемещение по доске
- Совместная работа нескольких пользователей
- Интеграция с GPT для генерации контента с поддержкой Markdown и LaTeX
- Управление доступом к доскам

## Структура проекта

```
src/
├── Pages/                     # Основные страницы приложения
│   ├── App/                   # Страницы после авторизации
│   │   └── BoardPage/         # Страница работы с доской
│   │       ├── Board/         # Компоненты доски
│   │       ├── HeadMenu/      # Верхнее меню
│   │       ├── Messages/      # Компонент чата
│   │       ├── Scale/         # Компонент масштабирования
│   │       └── ToolPanel/     # Панель инструментов
│   ├── Auth/                  # Страницы авторизации
│   └── ErrorPages/            # Страницы ошибок
├── redux/                     # Управление состоянием
├── config.js                  # Конфигурация приложения
├── global.scss                # Глобальные стили
└── variables.scss             # SCSS переменные
```

## Технологический стек

- **React** (v18) - основная библиотека для построения UI
- **Redux** - управление состоянием приложения
- **Ant Design** - UI компоненты
- **React Router** (v6) - маршрутизация
- **D3.js** - работа с SVG и графикой
- **WebSocket** - реальное время
- **Sass/SCSS** - стилизация
- **KaTeX** - рендеринг математических формул
- **React Markdown** - рендеринг Markdown

## Установка и запуск

1. Установите зависимости:
```bash
npm install
```

2. Запустите приложение в режиме разработки:
```bash
npm start
```

3. Соберите production версию:
```bash
npm run build
```

## Маршрутизация

Основные маршруты приложения:

- `/auth/signin` - страница входа
- `/auth/signup` - страница регистрации
- `/auth/confirm` - подтверждение email
- `/app/home` - главная страница с досками
  - `/app/home/my` - мои доски
  - `/app/home/shared` - доски, доступные мне
- `/app/board/:boardId` - страница работы с доской

## Основные компоненты

### BoardPage
Главная страница работы с доской. Содержит:
- `Board` - SVG-холст для рисования
- `ToolPanel` - панель инструментов
- `HeadMenu` - верхнее меню с настройками доски
- `Messages` - чат с сообщениями
- `Scale` - контроллер масштабирования

### Board (доска)
Реализована на SVG с использованием:
- Кастомного рендерера фигур
- Системы событий для рисования
- Оптимизированных обновлений через WebSocket

### ToolPanel
Инструменты:
- Карандаш (настройка цвета и толщины)
- Ластик
- Прямоугольник (цвет, толщина, заливка)
- Эллипс (цвет, толщина, заливка)
- GPT (генерация контента)

## Система состояний (Redux)

Состояние приложения хранится в Redux и включает:

```javascript
{
  state: 'idle', // Текущее состояние (idle, drawing и др.)
  tool: 'pencil', // Активный инструмент
  tools: {
    // Настройки для каждого инструмента
    pencil: { lineColor, lineWidth },
    eraser: { lineWidth },
    rectangle: { lineColor, fillColor, lineWidth },
    ellipse: { lineColor, fillColor, lineWidth },
    gpt: { status }
  },
  view: {
    scale: 1,      // Масштаб
    offsetX: 0,    // Смещение по X
    offsetY: 0,    // Смещение по Y
    startX: 0,     // Начальная точка X
    startY: 0      // Начальная точка Y
  },
  messages: [],    // Сообщения чата
  popover: {       // Панель GPT
    visible: false,
    request: null
  }
}
```

## Работа с API

Приложение использует сгенерированный API клиент (`est_proxy_api`) для работы с бэкендом. Основные методы:

- `BoardApi` - работа с досками (создание, получение, обновление)
- `UserApi` - авторизация, регистрация, поиск пользователей
- `GptApi` - интеграция с GPT

Пример запроса:
```javascript
const apiInstance = new BoardApi();
const data = await apiInstance.getByUuid(boardId);
```

## Функционал доски

### Рисование
- Поддержка различных инструментов (карандаш, фигуры)
- Настройка цвета, толщины, заливки
- Оптимизированная отрисовка через SVG
- История действий (undo)

### Масштабирование и перемещение
- Плавное масштабирование колесиком мыши
- Перемещение по доске (правой кнопкой мыши)
- Визуальный индикатор масштаба

### Совместная работа
- Отображение курсоров других пользователей
- Синхронизация изменений в реальном времени
- Управление правами доступа

### Интеграция с GPT
- Выделение области для генерации контента
- Отправка запросов к GPT
- Отображение результатов в чате

## Интеграция с WebSocket

Приложение использует два WebSocket соединения:

1. **FigureWebSocket** - для синхронизации фигур:
   - Создание/удаление/изменение фигур
   - Оптимизированная передача изменений

2. **MarkerWebSocket** - для отображения курсоров:
   - Передача позиций курсоров
   - Визуализация других пользователей

## Особенности реализации

1. **Оптимизация производительности**:
   - Дифференциальные обновления фигур
   - Дросселирование событий
   - Оптимизированный рендеринг SVG

2. **Режимы рисования**:
   - `idle` - бездействие
   - `creating` - создание фигуры
   - `drawing` - процесс рисования
   - `selecting` - выделение области (для GPT)

3. **Система координат**:
   - Учет масштаба и смещения
   - Преобразование координат между экраном и доской

4. **Чат**:
   - Поддержка Markdown
   - Рендеринг математических формул (LaTeX)
   - История сообщений

## Развертывание

1. Production сборка:
```bash
npm run build
```

2. Настройки окружения:
- `config.js` - URL бэкенда
- `package.json` - proxy настройки

3. Требования:
- Node.js v16+
- Современный браузер с поддержкой ES6

Приложение готово к развертыванию на хостинге.
